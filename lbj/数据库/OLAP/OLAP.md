# OLAP

## OLAP与OLTP(On-Line Transaction Procession)

OLTP基本特征是前台接受的用户数据可以立即传送到计算中心进行处理，并在很短的时间内给出处理结果，是对用户操作快速响应的方式之一，一般指传统的关系型数据库。OLAP一般指仓库型数据库，主要读取数据，做复杂数据分析、侧重技术决策支持，提供直观简单的结果。

### OLAP场景的关键特征

* 绝大多数是读请求
* 数据以相当大的批次(>1000行)更新，而不是单行更新或者根本没更新
* 已添加到数据库的数据不能修改(<s>啥意思，为啥感觉跟上一条有冲突</s>更新与修改不同，更新是指数据库引擎采用自己的策略选择范围进行更新，修改是指用户自己手动修改数据)
* 宽表，即每个表包含着大量的列，对于读取，从数据库中提取相当多的行，但只提取列的一小部分
* 对于简单查询，允许延迟大约50ms(这个是上限的意思还是下限的意思？)
* 对事物要求不高，一致性要求低(意思是可能不准的意思吗？)
* 查询较少(通常每台服务器每秒查询数百次或更少)，但单个查询却需要高吞吐量(每台服务器每秒可达数十亿行)

### I/O的优化

首先针对分析类查询，通常只需要读取表的小部分列，这样就可以减少无用数据的读取。其次数据按列读取，按列存储，相同类型的数据更容易被压缩，这样进一步减少了I/O的次数。

### CPU的优化

由于执行一个查询需要处理大量的行，因此在整个向量上执行所有操作将比在每一行上执行所有操作更加高效。(卧槽，又是不懂的概念。)且这将有助于实现一个几乎没有调用成本的查询引擎，如果不这样做将导致查询引擎不可避免的停止cpu进行等待，所以按列存储数据且按列执行是很有意义的。(懵～～～)  
实现方法：

1. 向量引擎：所有的操作都是为向量而不是为单个值编写的。这意味着多个操作之间不再需要频繁的调用，并且调用的成本基本可以忽略不计。操作代码包含一个优化的内部循环。(此处也不懂，大概就是使用向量引擎的意思？)
2. 代码生成：生成一段代码，包含查询中的所有操作(啥意思？即我们自己去规划怎么去访问存储空间，怎么去拿数据)

因为这在运行简单查询时是没有意义的，所以这不应该在通用数据库中实现。为了提高CPU效率，查询语言必须是[声明式语言](https://www.zhihu.com/question/22285830)(通俗来讲就是更接近人类语言的我要做什么，而不是具体的顺序+分支+循环的做流程)，如SQL或MDX，或者至少一个向量(a,b)。查询应该只包含隐式循环，允许进行优化。

### [ClickHouse](https://clickhouse.tech/docs/zh/)