# OLAP

## OLAP与OLTP(On-Line Transaction Procession)

OLTP基本特征是前台接受的用户数据可以立即传送到计算中心进行处理，并在很短的时间内给出处理结果，是对用户操作快速响应的方式之一，一般指传统的关系型数据库。OLAP一般指仓库型数据库，主要读取数据，做复杂数据分析、侧重技术决策支持，提供直观简单的结果。

### OLAP场景的关键特征

* 绝大多数是读请求
* 数据以相当大的批次(>1000行)更新，而不是单行更新或者根本没更新
* 已添加到数据库的数据不能修改，更新与修改不同，更新是指数据库引擎采用自己的策略选择范围进行更新，修改是指用户自己手动修改数据)
* 宽表，即每个表包含着大量的列，对于读取，从数据库中提取相当多的行，但只提取列的一小部分
* 对于简单查询，允许延迟大约50ms(这个是上限的意思还是下限的意思？)
* 对事物要求不高，一致性要求低(意思是可能不准的意思吗？)
* 查询较少(通常每台服务器每秒查询数百次或更少)，但单个查询却需要高吞吐量(每台服务器每秒可达数十亿行)

### I/O的优化

首先针对分析类查询，通常只需要读取表的小部分列，这样就可以减少无用数据的读取。其次数据按列读取，按列存储，相同类型的数据更容易被压缩，这样进一步减少了I/O的次数。

### CPU的优化

由于执行一个查询需要处理大量的行，因此在整个向量上执行所有操作将比在每一行上执行所有操作更加高效

## 列式数据库

列式存储以列为连续存储单位，行数据在存储时会被拆分存储在不同文件，或同一个文件的不同分段。

优点；

1. 利于数据压缩，因为同一列的数据具有相当的相同特性
2. 单列数据读取迅速

### [ClickHouse](https://clickhouse.tech/docs/zh/)

## 数据模型分层

### 数据运营层：ODS(Operational Data Store)

在源数据装入这一层时，要进行诸如去噪(例如有一条数据中人的年龄是300岁，这种属于异常数据，就需要提前做一些处理)、去重(例如在个人资料表中，同一ID却有两条重复数据，在接入的时候需要做一步去重)、字段命名规范等一系列操作，一般放在Hive表。最接近源数据层，为考虑后续数据追随，这层不建议做过多数据清洗工作，最好原封不懂接入原始数据。

### 数据仓库层：DW(Data Warehouse)

数据仓库层，需要从ODS层提取数据建立数据模型，又可分为DWD层，DWM层和DWS层。直接从DWD层把数据拉取到DWS层可能会因为计算力太大或维度太少造成资源消耗过大，所以一般的解决方案是先从DWD层计算到几个DWM表，然后拼接成DWS,DWM层可以直接用完即删。

1. DWD(Data Warehouse Detail)DWD层要做的是将数据清理、整合、规范化、脏数据、垃圾数据、规范不一致的、状态定义不一致的、命名不规范的数据整合成统一规格（粒度）。ods层和dim层联表的到？
2. DWM/DWB(Data Warehouse Middle/Base)DWM会在DWD层的基础上，对数据做轻度的聚合操作，生成一系列中间表，提升公共指标的复用性，减少重复加工。
3. DWS(Data Warehouse Summary)DWS层为公共汇总层，会进行轻度汇总，粒度比明细数据稍粗，DWS层会整合汇总成分析某一个主题域的服务数据，一般是字段比较多的宽表，DWS层至少能覆盖80%的应用场景。

### 数据应用层：ADS(Application Data Service)

APP层主要用于提供数据产品和数据分析使用的数据，一般存放在ES、PostgreSQL、Redis等系统中供线上系统使用。