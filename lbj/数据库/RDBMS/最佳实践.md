# 最佳实践

## 批量删除

## 批量插入

批量插入：`insert into table_names() values(),...`和`insert into select`  

1. `replace into ...`:如有冲突先删除再插入，感觉性能会比较一般，删除和插入应该会影响b+树的分裂合并
2. `... on duplicate key update a=values(a),...`:如有冲突则更新，性能应该会比上好
3. `insert ignore into ...`:忽略插入，如有冲突或约束则跳过该插入继续执行。除了唯一约束的冲突，类似字段超出长度、类型不匹配等错误，前两种插入都会整体失败，但insert ignore into 则不会。它对于类型不匹配且无法转化的提供了默认值，超出了长度的单招最大长度进行截取。(由此可见很容易会漏掉错误而不被发现，所以用的少)

### ... on duplicate key update $col = $value;

1. 在执行插入时，如果遇见了unique索引或primary key中出现重复值，则等同于update操作，但是显示影响2行
2. 如果有多个条件被匹配，则会表现为condition1 or condition2 ,但只会对第一次匹配到的行执行update操作

## 使用redis作为读数据库，mysql读从库存在的意义

数据备份？

### mysql不要使用外键的原因

1. mysql的及联删除导致如redis等相关依赖没有察觉